<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Learning makes me happy."><title>SQL Notes: Group Functions | Welcome to Steven's Blog</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/7.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">SQL Notes: Group Functions</h1><a id="logo" href="/.">Welcome to Steven's Blog</a><p class="description">Most posts are still in old blog. http://blog.csdn.net/firehotest</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">SQL Notes: Group Functions</h1><div class="post-meta">Sep 20, 2017<span> | </span><span class="category"><a href="/categories/Techniques/">Techniques</a></span></div><div class="post-content"><p>今天我们来讲一讲Group Function。回顾之前，我们讲了在WHERE子句的条件样式：比较符号 + 列名、比较符号 + ANY或者ALL +（列，名，们）、LIKE + Wildcard, BETWEEN…AND…, IN + (列，名，们), IS NULL. </p>
<p>多表查询的在WHERE后面qualified的等式或者不等式，JOIN…ON（不等式或者名字不同的等式）和JOIN…USING (等式且名字相同)。LEFT, RIGHT, FULL JOIN的Outer Join。</p>
<p>ORDER BY是整个SQL句式中只能出现一次并只能出现在末尾的句式。ORDER BY后面根据列的排序优先顺序排列。默认的排序方式有两个：1）默认是升序，如果是要按照某一列的降序，则在列名之后添加DESC关键字。2）默认NULL在最后，如果要把NULL排在前面，则需要NULL FIRST关键字。</p>
<p>那么GROUP FUNCTION又是怎么用的呢？可以将它看作是一种post-processing. </p>
<h2 id="SQL语句的处理流程"><a href="#SQL语句的处理流程" class="headerlink" title="SQL语句的处理流程"></a>SQL语句的处理流程</h2><p>为什么说是post-processing？首先我们来看SQL语句的处理流程：</p>
<p>Step1: FROM 哪些表，有没有JOIN，怎么JOIN</p>
<p>Step2: WHERE的条件是什么，选择哪些row出来</p>
<p>Step3: GROUP BY and<br> HAVING 把选择出来的rows怎么组合呈现给用户</p>
<p>Step4: SELECT这些rows里面的哪些列给用户看</p>
<p>Step5: ORDER BY怎么给这些rows排序</p>
<h2 id="怎么用GROUP-BY，什么是HAVING"><a href="#怎么用GROUP-BY，什么是HAVING" class="headerlink" title="怎么用GROUP BY，什么是HAVING"></a>怎么用GROUP BY，什么是HAVING</h2><p>Group By实质是从筛选剩下的行当中，按照某一列的值作为key去归类。归类之后创建一个新的行。行的内容是SELECT里面的原有列 + SELECT里面用Group Function创建的列。</p>
<p>Group Function的意义是，针对归类后的同一类的行进行统计，结果反映其统计数据。</p>
<p>HAVING对于GROUP BY而言，如何WHERE对于SELECT而言。不同的是，对于Group Function组成的新列的条件必须在HAVING里面表达。而原有列的条件则在WHERE表达。</p>
<p>这里强调一点，如果SELECT之后跟了Group Function组成的心列，在SELECT里面出现的原有列必须在GROUP BY里面出现。GROUP BY的用法类似于ORDER BY，根据优先顺序排列组合的条件。</p>
<p>但反之，GROUP BY里面出现的列名，不需要一定出现在SELECT后面。</p>
<h2 id="常用的Group-Function有哪些"><a href="#常用的Group-Function有哪些" class="headerlink" title="常用的Group Function有哪些"></a>常用的Group Function有哪些</h2><p>MIN, MAX和COUNT对于任何类型的数据都适用。</p>
<p>SUM, AVG, MEDIAN, STDDEV, VARIANCE对于数值类数据使用。</p>
<p>COUNT是唯一一个会care NULL值的Group Function，其余都忽略NULL值。</p>
<h2 id="几个例子"><a href="#几个例子" class="headerlink" title="几个例子"></a>几个例子</h2><p>How many books do we have in each book category? Order the result alphabetically.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">SQL&gt; SELECT category, COUNT(ISBN) </div><div class="line">FROM books</div><div class="line">GROUP BY categoryORDER BY category;</div></pre></td></tr></table></figure>
<p>Find the categories and the average expected profit for those categories that have average expected profit above $15. Sort by the average expected profit in descending order.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">SQL&gt; SELECT category,</div><div class="line">TO_CHAR(AVG(retail-cost),'$990.99') "Profit" </div><div class="line"></div><div class="line">FROM books</div><div class="line">GROUP BY category</div><div class="line">HAVING AVG(retail-cost) &gt; 15ORDER BY AVG(retail-cost) DESC;</div></pre></td></tr></table></figure>
<p>Find the categories and the average expected profit for those categories with average expected profit above $15 for books that were published since January 1st, 2005</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">SQL&gt; SELECT category,</div><div class="line">TO_CHAR(AVG(retail-cost),'$990.99') "Profit"</div><div class="line"></div><div class="line">FROM books</div><div class="line">WHERE pubdate &gt;= '01-Jan-05'</div><div class="line">GROUP BY category</div><div class="line">HAVING AVG(retail-cost) &gt; 15;</div></pre></td></tr></table></figure>
</div><div class="tags"><a href="/tags/SQL/">SQL</a></div><div class="post-nav"><a href="/2017/09/19/SQL-Notes-Set-Operations/" class="next">SQL Notes: Set Operations</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://stevenlicmu.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Techniques/">Techniques</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/SQL/" style="font-size: 15px;">SQL</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/09/20/SQL-Notes-Group-Functions/">SQL Notes: Group Functions</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/19/SQL-Notes-Set-Operations/">SQL Notes: Set Operations</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/18/SQL-Notes-Multi-table-Query/">SQL Notes: Multi-table Query</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/17/SQL-Notes-Single-Query/">SQL Notes: Single Query</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="http://blog.csdn.net/firehotest" title="Old Blog" target="_blank">Old Blog</a><ul></ul><a href="http://github.com/stevenlicmu" title="GitHub" target="_blank">GitHub</a><ul></ul><a href="http://www.linkedin.com/in/stevenlicmu/" title="LinkedIn" target="_blank">LinkedIn</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2017 <a href="/." rel="nofollow">Welcome to Steven's Blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.1.20/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>